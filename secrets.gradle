ext.loadSecret = { key ->
    try {
        def secret = System.getenv(key) ?: loadLocalSecret(key)
    } catch (FileNotFoundException ignored) {
        throw new IllegalArgumentException("Cannot find secret property $key\n" +
                " - If running on CI ensure you add the property as Encrypted Environment variable\n" +
                " - If running on local, add the property to your secrets.properties file.")
    }
}

def String loadLocalSecret(key) {
    def localSecrets = new Properties()
    file("secrets.properties").withInputStream { localSecrets.load(it) }
    return localSecrets.getProperty(key)
}
